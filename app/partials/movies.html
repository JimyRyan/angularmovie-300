<!-- header-->
<header class="page-header">
    <h1>Ma vidéothèque <small>{{filteredMovies.length}} films</small>
        <button class="btn btn-primary" data-toggle="modal" data-target="#movie-form-modal">Ajouter un film</button>
    </h1>
</header>

<!-- barre d'actions -->
<section class="well form-inline">
    <input class="span5" type="text" ng-model="search" placeholder="Rechercher" ng-change="filterMovies()">
    <section class="pull-right">
        <button class="btn btn-success" ng-click="toogleView()"><i ng-class="tableViewIcon"></i></button>
        <button class="btn btn-info" ng-click="sortMovies('releaseYear', !reverse)">Trier par année</button>
        <button class="btn btn-info" ng-click="sortMovies('title', !reverse)">Trier par titre</button>
    </section>
</section>


<!-- liste des films -->
<div ng-switch on="tableView" >
<ul class="thumbnails" ng-switch-when="false">
    <li ng-repeat="movie in filteredMovies" class="span12">
        <img ng-src="{{movie.poster | poster}}" class="span2" ui-sref="movie({id: movie.id})">
        <div class="caption">
            <h3><span ui-sref="movie({id: movie.id})">{{movie.title | uppercase}}</span>
                <button class="btn btn-danger" ng-click="deleteMovie($index)"><i class="icon-trash icon-white"></i></button>
                <a class="btn btn-info" href="#/movies/edit/{{movie.id}}"><i class="icon-edit icon-white"></i></a>
            </h3>
            <editable label="Année de sortie" text="movie.releaseYear"></editable>
            <editable label="Réalisateurs" text="movie.directors"></editable>
            <editable label="Acteurs" text="movie.actors"></editable>
            <p><b>Synopsis : </b>{{movie.synopsis}}</p>
            <p><b>Note : </b>{{movie.rate | stars}}</p>
        </div>
    </li>
</ul>
<table class="table table-striped" ng-switch-default>
    <thead>
    <tr>
        <th>#</th>
        <th>Titre</th>
        <th>Réalisateur</th>
        <th>Année de sortie</th>
        <th>Note</th>
    </tr>
    </thead>
    <tbody>
    <tr ng-repeat="movie in filteredMovies">
        <td>{{$index + 1}}</td>
        <td><editable text="movie.title"></editable></td>
        <td>{{movie.directors}}</td>
        <td>{{movie.releaseYear}}</td>
        <td>{{movie.rate | stars}}</td>
    </tr>
    </tbody>
</table>
</div>


<!-- formulaire de création - caché par défaut -->
<div id="movie-form-modal" class="modal hide fade" ng-controller="movieFormController">
    <header class="modal-header">
        <button type="button" class="close" data-dismiss="modal">x</button>
        <h3>Ajouter un film</h3>
    </header>
    <section class="modal-body">
        <form name="movieForm" class="form-horizontal">
            <div class="control-group" ng-class="{error : movieForm.inputTitle.$error.required || movieForm.inputTitle.$error.titleAvailable}">
                <label class="control-label">Titre :</label>
                <input movie-available-validator type="text" name="inputTitle" ng-model="movie.title" ng-model-options="{ debounce: { default : 500, blur: 0 }}" autofocus required />
                <span class="help-block" ng-show="movieForm.inputTitle.$error.required">Le titre est obligatoire</span>
                <span class="help-block" ng-show="movieForm.inputTitle.$error.titleAvailable">Le titre n'est pas disponible</span>
            </div>
            <div class="control-group" ng-class="{error : movieForm.inputYear.$error.pattern}">
                <label class="control-label">Année de sortie :</label>
                <input type="text" name="inputYear" ng-model="movie.releaseYear" ng-pattern="/(19|20)\d\d/">
                <span class="help-block" ng-show="movieForm.inputYear.$error.pattern">L'année n'est pas valide</span>
            </div>
            <div class="control-group" ng-class="{error : movieForm.inputDirectors.$error.director}">
                <label class="control-label">Réalisateur : </label>
                <input director-validator type="text"  name="inputDirectors" ng-model="movie.directors">
                <span class="help-block" ng-show="movieForm.inputDirectors.$error.director">Le Realisateur doit avoir un nom et un prénom</span>
            </div>
            <div class="control-group">
                <label class="control-label">Acteurs :</label>
                <input type="text" ng-model="movie.actors">
            </div>
            <div class="control-group" ng-class="{error : movieForm.textareaSynopsis.$error.maxlength}">
                <label class="control-label">Synopsis :</label>
                <input type="text" ng-model="movie.synopsis" name="textareaSynopsis"  ng-maxlength="140">
                <span class="help-block" ng-show="movieForm.textareaSynopsis.$error.maxlength">140 caractères maximum</span>
            </div>
            <div class="control-group" ng-class="{error : movieForm.inputRate.$error.min || movieForm.inputRate.$error.max}">
                <label class="control-label">Note :</label>
                <rating ng-model="movie.rate" max="5"><i class="fa fa-star"></i></rating>
            </div>
        </form>
    </section>
    <footer class="modal-footer">
        <button data-dismiss="modal" class="btn btn-danger btn-small">Annuler</button>
        <button class="btn btn-success" ng-click="addMovie(movie)" ng-disabled="movieForm.$invalid">Ajouter</button>
    </footer>
</div>